{% extends "base.html" %}
{% block content %}

<div class="ethical-warning">
  <strong>⚠️ Aviso Importante:</strong>
  <ul>
    <li>Este sistema é para <strong>consulta rápida e apoio</strong>. Ele NÃO substitui a leitura do Código de Ética nem a consulta oficial ao <strong>CFP</strong> ou ao seu CRP.</li>
    <li><strong>Privacidade:</strong> As perguntas não são usadas para treinar IAs externas. Os dados ficam apenas no seu histórico local.</li>
  </ul>
</div>

<section class="card">
  <div style="margin-bottom: 18px;">
    <h2 style="margin:0;">Consulta Ética</h2>
    <p style="margin:6px 0 0 0; color:#64748b; font-size:0.92rem;">
      As perguntas com respostas objetivas ficam no topo.
    </p>

    <div class="seal-legend">
      <span class="seal-item seal-green"><span class="dot dot-green"></span> Resposta objetiva</span>
      <span class="seal-item seal-yellow"><span class="dot dot-yellow"></span> Zona de cuidado</span>
    </div>
  </div>

  <!-- BLOCO 1: RESPOSTAS OBJETIVAS -->
  <h3 class="section-mini">Respostas objetivas</h3>
  {% if direct_questions and direct_questions|length > 0 %}
    <div class="quick-questions">
      <div class="quick-grid">
        {% for qq in direct_questions %}
          <form method="post" style="margin:0;">
            <input type="hidden" name="q" value="{{ qq.text }}">
            <button class="quick-btn" type="submit">
              <span class="dot dot-green"></span>
              <span class="quick-text">{{ qq.text }}</span>
            </button>
          </form>
        {% endfor %}
      </div>
    </div>
  {% else %}
    <div class="muted-box">
      Nenhuma pergunta com resposta objetiva foi cadastrada ainda.
      Adicione respostas em <strong>RESPOSTAS_PRONTAS</strong> para aparecerem aqui.
    </div>
  {% endif %}

  <!-- BLOCO 2: ZONA DE CUIDADO -->
  <h3 class="section-mini" style="margin-top:18px;">Zona de cuidado</h3>
  {% if care_questions and care_questions|length > 0 %}
    <div class="quick-questions">
      <div class="quick-grid">
        {% for qq in care_questions %}
          <form method="post" style="margin:0;">
            <input type="hidden" name="q" value="{{ qq.text }}">
            <button class="quick-btn" type="submit">
              <span class="dot dot-yellow"></span>
              <span class="quick-text">{{ qq.text }}</span>
            </button>
          </form>
        {% endfor %}
      </div>
    </div>
  {% else %}
    <div class="muted-box">
      Nenhuma pergunta na zona de cuidado.
    </div>
  {% endif %}

  <form method="post" style="margin-top: 18px;">
    <button class="btn-action" type="submit" name="load_bases" value="1">
      Atualizar base do Código
    </button>
  </form>

  {% if answer %}
    <div class="answer-container">
      {{ answer|safe }}
    </div>
  {% endif %}
</section>

<section class="card">
  <h3>Histórico Recente</h3>
  {% if history %}
    <ul class="history-list">
      {% for h in history %}
        <li style="border-bottom: 1px solid #f1f5f9; padding: 10px 0;">
          <small style="color: #94a3b8; font-size: 0.75rem;">{{ h.created_at }}</small>
          <div style="font-weight: 600; font-size: 0.9rem; color: #0f172a;">{{ h.question }}</div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p style="color: #94a3b8; font-size: 0.9rem;">Nenhuma consulta recente.</p>
  {% endif %}
</section>

{% endblock %}
