{% extends "base.html" %}
{% block content %}

<section class="card">
  <h2 style="margin-top:0;">Políticas prontas</h2>
  <p style="color:#64748b; margin-top:6px;">
    Gere textos curtos para copiar e colar. Evite inserir dados de pacientes.
  </p>

  <form method="post" class="form-grid">
    <div class="form-card">
      <h3>Escolha</h3>

      <label class="field">
        Tipo
        <select name="tipo">
          <option value="faltas">Faltas e cancelamentos</option>
          <option value="mensagens">Mensagens e contato</option>
          <option value="reembolso">Pagamentos e reembolso</option>
          <option value="online">Protocolo online</option>
          <option value="sigilo">Sigilo e privacidade</option>
        </select>
      </label>

      <label class="field">
        Modalidade
        <select name="modalidade">
          <option selected>Online</option>
          <option>Presencial</option>
        </select>
      </label>

      <label class="field">
        Prazo (horas)
        <select name="prazo">
          <option value="12">12</option>
          <option value="24" selected>24</option>
          <option value="48">48</option>
        </select>
      </label>

      <label class="field">
        Atraso (min)
        <select name="atraso">
          <option value="10">10</option>
          <option value="15" selected>15</option>
          <option value="20">20</option>
        </select>
      </label>

      <label class="field">
        Falta fora do prazo é cobrada?
        <select name="falta_cobra">
          <option value="sim" selected>Sim</option>
          <option value="nao">Não</option>
        </select>
      </label>
    </div>

    <div class="form-card">
      <h3>Detalhes</h3>

      <label class="field">
        Canal
        <select name="canal">
          <option selected>WhatsApp</option>
          <option>E-mail</option>
          <option>Telegram</option>
        </select>
      </label>

      <label class="field">
        Mensagens (regra)
        <select name="mensagens">
          <option value="logistica" selected>Apenas logística</option>
          <option value="curtas">Curtas e objetivas</option>
          <option value="nao_substitui">Não substitui sessão</option>
        </select>
      </label>

      <label class="field">
        Queda (min)
        <select name="queda">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="15">15</option>
        </select>
      </label>

      <label class="field">
        Pagamento
        <select name="pagamento">
          <option value="pix" selected>Pix</option>
          <option value="transferencia">Transferência</option>
          <option value="cartao">Cartão</option>
        </select>
      </label>

      <label class="field">
        Reembolso/ajuste em interrupção?
        <select name="reembolso">
          <option value="nao" selected>Não</option>
          <option value="sim">Sim</option>
        </select>
      </label>

      <button class="btn-action" type="submit" style="margin-top:10px; width:100%;">
        Gerar texto
      </button>
    </div>
  </form>
</section>

{% if out %}
<section class="card">
  <h2 style="margin-top:0;">{{ out.titulo }}</h2>

  <div class="copy-row">
    <button class="btn-action" type="button" onclick="copyText()">Copiar</button>

    <form method="post" action="{{ url_for('download_docx') }}" style="margin:0;">
      <input type="hidden" name="doc_title" value="{{ out.titulo }}">
      <input type="hidden" name="doc_filename" value="politica">
      <input type="hidden" name="doc_text" value="{{ out.texto|e }}">
      <button class="btn-action" type="submit">Baixar em Word</button>
    </form>
  </div>

  <textarea id="outText" class="mono-area" readonly>{{ out.texto }}</textarea>
</section>

<script>
  function copyText(){
    const el = document.getElementById("outText");
    el.select();
    el.setSelectionRange(0, 999999);
    document.execCommand("copy");
  }
</script>
{% endif %}

{% endblock %}
